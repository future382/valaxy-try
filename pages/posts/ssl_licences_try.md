---
cover: https://s2.loli.net/2023/08/19/EkPysM5uZqNbn1O.jpg
title: Letâ€™s Encrypt | é€šé…ç¬¦è¯ä¹¦ç”³è¯·
date: 2023-4-30
categories: äº‘è¿¹çš„å°å·¥å…·
tags:
 - åˆ©å™¨
 - Web
 - SSL/TLS  
---


ç”³è¯·ä¸€ä¸ªå…è´¹çš„SSLè¯ä¹¦ è¿˜æ˜¯æŒºå®¹æ˜“çš„ï¼Œé€”å¾„å¾ˆå¤šï¼Œä¾‹å¦‚Letâ€™s Encryptè¿™ç§æœºæ„ï¼Œä¹Ÿä¸éœ€è¦å®åï¼Œåªéœ€è¯æ˜ä½ å¯¹å…·ä½“çš„åŸŸåæœ‰â€˜æ‹¥æœ‰æƒâ€™å³å¯ã€‚

## æ•…äº‹

è¿™ç§â€˜æ‹¥æœ‰æƒâ€™å¹¶ä¸æ˜¯æ³•å¾‹æ„ä¹‰ä¸Šçš„æ‹¥æœ‰ï¼Œè¯´â€˜æ“ä½œæƒâ€™æˆ–è®¸æ›´åˆé€‚ï¼Œä¾‹å¦‚ï¼Œå³ä½¿è¿™ä¸ªåŸŸåæ³•å¾‹ä¸Šæ˜¯å±äºæŸäººAï¼Œè¢«é»‘å®¢Bé€šè¿‡ç¤¾ä¼šå·¥ç¨‹å­¦æŠŠåŸŸåç³»ç»Ÿè´¦å·å¼„åˆ°æ‰‹äº†ï¼Œå¯ä»¥å¯¹è¯¥åŸŸåè®¾ç½®å„ç§DNSè®°å½•ï¼Œé‚£ä¹ˆè¿™ä¸ªåŸŸååœ¨Letâ€™s Encryptè¯ä¹¦é¢å‘æœºæ„çœ‹æ¥ï¼Œå®é™…æ˜¯å±äºé»‘å®¢Bçš„ï¼Œä»ç„¶ä¼šä¸ºè¿™ä¸ªåŸŸåé¢å‘è¯ä¹¦ï¼Œå½“ç„¶è¿™ä¸ªè¯ä¹¦ä¹Ÿå°±åŒ…å«äº†é»‘å®¢Bæ‰€æœŸæœ›çš„ä¿¡æ¯ã€‚

ç›¸å¯¹äºä¼ ç»Ÿæœºæ„è¯ä¹¦é¢å‘æ–¹å¼ï¼ŒLetâ€™s Encryptè¿™ç±»æœºæ„ä¸å†æ ¸éªŒ ä¸€å¤§å †çš„æ³•å¾‹ä¸Šçš„ï¼Œç‰©ç†ä¸Šçš„èµ„æ–™å»æ ¡éªŒè¿™ä¸ªåŸŸåçš„æ‰€å±ï¼Œè€Œæ˜¯ä»…ä»…é€šè¿‡å®é™…çš„ï¼Œè°å¯ä»¥æ“ä½œè¿™ä¸ªåŸŸåï¼Œå°±é¢å‘ç»™è°ï¼ŒåŒ…å«è°éœ€è¦çš„ä¿¡æ¯ã€‚

è¿™ç§æ–¹å¼å…¶å®æ˜¯æ”¾å®½äº†è¯ä¹¦ç”³è¯·çš„é—¨æ§›ï¼Œ ä»¥å‰æ ¡éªŒä¿¡æ¯å¤šå¤šå°‘å°‘éœ€è¦å’Œç°å®ä¸»ä½“æ‰¯ä¸Šç‚¹è”ç³»ï¼Œå¯èƒ½æ˜¯ä¸ªè¡Œæ”¿å®¡æ‰¹æ´»ï¼Œç°åœ¨æ˜¯ä¸ªçº¯æŠ€æœ¯æ ¡éªŒï¼Œå®Œå…¨è™šæ‹Ÿä¸–ç•Œå†…å®Œæˆã€‚

é—¨æ§›é™ä½ï¼Œä¸€å®šç¨‹åº¦ä¸Šå®‰å…¨æ€§é™ä½ï¼Œå¯ä¿¡åº¦é™ä½ï¼Œæ‰€ä»¥å¤§å…¬å¸ï¼Œæ”¿åºœç­‰ç­‰è¡Œä¸šè¿˜æ˜¯ä¼šæ²¿ç”¨ä»¥å‰çš„è¯ä¹¦ç”³è¯·æ–¹å¼ï¼ŒåŒæ—¶Letâ€™s Encryptç±»ä¼¼æœºæ„ä¸ºäº†æå‡è¿™ç§æ–¹å¼çš„å®‰å…¨æ€§ï¼Œè¯ä¹¦çš„æœ‰æ•ˆæœŸåªæœ‰å¤©90å¤©ï¼Œè¿‡æœŸé‡æ–°ç”³è¯·ã€‚

è¿™æ˜¯ä¸€ç§æ€æƒ³è§£æ”¾ï¼Œä¸€ç§å®‰å…¨ç†å¿µçš„æ”¹å˜ï¼Œä¸€ç§æ–°çš„å•†ä¸šæ¨¡å¼ï¼ŒLetâ€™s Encryptå½“æ—¶çš„æ¨ªç©ºå‡ºä¸–æ—¶ï¼Œæ…åŠ¨è¿™ä¸ªè¡Œä¸šï¼Œç°åœ¨çœ‹æ¥ï¼Œå–å¾—äº†æˆåŠŸã€‚

## å¦‚ä½•éªŒè¯â€™æ‹¥æœ‰æƒâ€˜

![img](https://blog-samliu-tech-1300751433.cos.ap-shanghai.myqcloud.com/wp-content/uploads/2022/08/image-8.png)

- **å­åŸŸå**

å¦‚ä¸Šå›¾ï¼Œä¸¤æ­¥èµ°ã€‚é…åˆCertbotå®¢æˆ·ç«¯ç¨‹åºï¼Œå®ƒä¼šåœ¨Serverç«¯ä¸´æ—¶å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡ï¼Œå†™å…¥ä¸€äº›æ•°æ®ï¼Œç„¶åå‘Šè¯‰Letâ€™s Encryptï¼Œæ¥è®¿é—®ssl.yunji.blogï¼Œå¦‚æœèƒ½æˆåŠŸè®¿é—®åˆ°Serverï¼Œåˆ™è¯æ˜ä½ å¯¹ssl.yunji.blogæœ‰â€œæ‹¥æœ‰æƒâ€ï¼Œä¼šé¢å‘è¯ä¹¦ï¼Œä½ æ‰€éœ€è¦åšçš„å°±æ˜¯é…ç½®ssl.yunji.blogæŒ‡å‘Serverçš„Aè®°å½•å¹¶æ”¾å¼€80/443ç«¯å£å³å¯ã€‚

- **äºŒçº§åŸŸå**

å¦‚ä¸Šå›¾ï¼Œä¸‰æ­¥èµ°ã€‚ä¾‹å¦‚yunji.blogè¿™ä¸ªäºŒçº§åŸŸåï¼Œå¦‚æœé’ˆå¯¹æ‰€æœ‰å­åŸŸåä¸€ä¸ªä¸ªç”³è¯·å¤ªç¹çï¼Œå¯ä»¥ç”³è¯·ä¸€ä¸ªé€šé…ç¬¦è¯ä¹¦ï¼Œä¾‹å¦‚*.yunji.blogï¼Œè¿™ç§è¯ä¹¦ç”³è¯·çš„éªŒè¯æ–¹å¼æœ‰äº›ä¸åŒï¼Œåªèƒ½ä½¿ç”¨DNS ChallengeéªŒè¯ã€‚

Certbot DNS Challenge ï¼Œé¦–å…ˆåœ¨ä½ çš„åŸŸåæ‰˜ç®¡æœºæ„è´¦æˆ·ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªapi tokenï¼Œè¦æ±‚å…·æœ‰è¯»å†™DNS Zoneçš„æƒé™ï¼Œç„¶åæ·»åŠ tokenä¿¡æ¯åˆ°Certbotï¼Œè¿™æ ·Certbotç”³è¯·çš„æ—¶å€™ï¼Œé€šè¿‡APIï¼Œåœ¨ä½ çš„DNSè´¦æˆ·å¯¹åº”åŸŸåç©ºé—´ä¸‹åˆ›å»ºä¸€ä¸ªTXTè®°å½•ï¼Œæœ€åCertbotå‘Šè¯‰Letâ€™s Encryptï¼Œå»è¯»å–è¿™ä¸ªTXTè®°å½•ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è¯æ˜ä½ å¯¹yunji.blogæœ‰â€œæ‹¥æœ‰æƒâ€ï¼Œä¼šé¢å‘é€šé…ç¬¦è¯ä¹¦ï¼Œé¢å‘åï¼ŒTXTè®°å½•ï¼Œä¼šè¢«Certbotåˆ é™¤

![img](https://blog-samliu-tech-1300751433.cos.ap-shanghai.myqcloud.com/wp-content/uploads/2022/08/cloudflare_DNS-TXT-1024x50.jpg)

TXTè®°å½•

## Dockeréƒ¨ç½²Certbot

éƒ¨ç½²å‰ï¼Œå…ˆå»å¼„ä¸€ä¸ªäºŒçº§åŸŸåï¼Œä¾‹å¦‚æˆ‘åœ¨Namesiloè´­ä¹°çš„åŸŸå yunji.blog,åŒæ—¶æˆ‘çš„åŸŸåæ‰˜ç®¡æœºæ„ä¹Ÿæ˜¯Namesiloï¼Œè¿™é‡Œï¼Œæˆ‘ä¸åœ¨Namesiloè´¦æˆ·ç”³è¯·api tokenï¼Œå› ä¸ºCertbotå¯¹Namesiloè¿™ä¸ªåŸŸåæ‰˜ç®¡æœºæ„é€‚é…ä¸å¤ªå¥½ï¼Œæ‰€ä»¥æˆ‘æŠŠyunji.blogçš„æ‰˜ç®¡æœºæ„ä»Namesiloè¿ç§»åˆ°äº†Cloudflareï¼Œè¿ç§»åï¼Œå­åŸŸåçš„ç®¡ç†å·¥ä½œå°±äº¤ç”±Cloudflareï¼Œæ·»åŠ æ–°è®°å½•æ—¶ï¼ŒåŒæ­¥åˆ°å›½å†…æ¥ï¼Œä¼šç¨å¾®æœ‰äº›æ…¢ï¼Œä¸è¿‡![ğŸ†—](https://s.w.org/images/core/emoji/14.0.0/svg/1f197.svg)ã€‚

- **æ³¨å†ŒCloudflare**
- **æ·»åŠ ç½‘ç«™/åŸŸå**
- **æ›´æ”¹Nmasilo **Nameservers**
- **ç­‰å¾…ä¸€å¤©ï¼ŒCloudflareå¼€å§‹æ‰˜ç®¡**
- **åœ¨Cloudflareï¼Œé‡æ–°é…ç½®ä¹‹å‰DNSè®°å½•**(**DNS ONLY**)
- **ç”³è¯·Cloudflare api tokenï¼ˆåªéœ€ç¼–è¾‘DNZ Zone æƒé™å³å¯ï¼‰**

[![img](https://blog-samliu-tech-1300751433.cos.ap-shanghai.myqcloud.com/wp-content/uploads/2022/08/image-9-1024x378.png)](https://blog-samliu-tech-1300751433.cos.ap-shanghai.myqcloud.com/wp-content/uploads/2022/08/image-9.png)

![img](https://blog-samliu-tech-1300751433.cos.ap-shanghai.myqcloud.com/wp-content/uploads/2022/08/image-10.png)

- **åˆ›å»ºCertbot container**

```
docker run -d --name letsencrypt_testing \
--cap-add=NET_ADMIN \
-e PUID=1000 \
-e PGID=1000 \
-e TZ=Asia/Shanghai \
-e URL=yunji.blog \
-e SUBDOMAINS=wildcard \
-e VALIDATION=dns \
-e DNSPLUGIN=cloudflare \
-e DHLEVEL=2048 \
-v /home/yunji5342/letsencrypt-config_testing:/config \
--restart unless-stopped \
linuxserver/swag
```

- **æ·»åŠ Cloudfalre token**

```
sudo nano /home/yunji5342/letsencrypt-config_testing/dns-conf/cloudflare.ini
æ›´æ”¹å¦‚ä¸‹é…ç½®
 
# Instructions: https://github.com/certbot/certbot/blob/master/certbot-dns-cloudflare/certbot_dns_cloudflare/__init__.py#L20
# Replace with your values
 
# With global api key:
#dns_cloudflare_email = cloudflare@example.com
#dns_cloudflare_api_key = 0123456789abcdef0123456789abcdef01234567
 
# With token (comment out both lines above and uncomment below):
dns_cloudflare_api_token = xxxxxxxxxxxxxxxxxxx
```

- **é‡å¯containerï¼Œå®Œæˆç”³è¯·è¿‡ç¨‹ï¼ŒæŸ¥çœ‹è¯ä¹¦å’Œç§é’¥**

  

å‚è€ƒèµ„æ–™/å·¥å…·ï¼š

#### ECCè¯ä¹¦

* https://imququ.com/post/ecc-certificate.html
* https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/
* https://cloud.tencent.com/developer/article/1426836?from=article.detail.1420663
* https://github.com/acmesh-official/acme.sh

#### è¯ä¹¦æµ‹è¯•å·¥å…·

* [https://cipherlist.eu](https://cipherlist.eu/) tls chipsé…ç½®æœ€ä½³å®è·µ
